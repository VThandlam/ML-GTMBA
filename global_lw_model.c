//Analysis Type - Regression 
#include <stdio.h>
//#include <conio.h>
#include <math.h>
#include <stdlib.h>


double global_lw_train_1_MLP_10_40_1_input_hidden_weights[40][10]=
{
 {-6.74871640190982e-001, -7.77994911835098e-003, 2.14933081399178e+000, 3.44390392223896e-001, -2.53408113148591e+000, 2.23903525658976e+000, 1.02760279308886e+000, -1.82347028699043e+000, -4.54625840906024e-001, -5.64915892832576e-001 },
 {2.09179028109675e+000, 8.20612442657622e-002, -2.41996063738071e+000, 4.27592456925933e-001, 2.07090068053049e+000, 1.07616173065650e-001, -4.45982885293470e-001, 4.30401817017247e-001, 9.40241422181211e-002, -1.92082349397178e-001 },
 {8.59938222086026e-001, 2.05455427880400e-002, -4.26738089323508e+000, -4.09741463901386e+000, 5.52930847904666e-001, 2.97955272745144e-001, -9.19861674614825e-001, 4.10716797429910e+000, -9.13384481949975e-002, 1.28845848583749e+000 },
 {-6.01503855809620e-001, 3.97127269208503e-001, -1.94970124495464e+000, -3.29707213115950e+000, 1.06840195401466e+000, 8.70552823869533e-002, 1.70831355037619e+000, -5.37642157134071e+000, 3.03108949168447e-001, 2.02320454353280e+000 },
 {2.22574017689763e+000, -5.28699605132577e-001, -1.72222639592577e-002, -3.89789288612140e+000, -2.47438593623932e-001, -3.54945426849484e+000, -3.42204426620606e+000, 3.45950587921520e+000, -1.18422270888587e+000, -4.19747907542995e-001 },
 {1.50018723712876e-001, -7.17052723179622e-002, -1.93934015072200e+000, -4.35728372112472e+000, -1.28761779328545e+000, 3.92865723580975e-001, -9.52667460451584e-001, -5.60709119779077e-001, 9.28088327419462e-002, -7.55206721344400e-001 },
 {-3.58315047598037e-001, -6.36627109463620e-002, 1.62618936790704e+000, -5.86415435229632e+000, 5.24983891625500e-001, 2.38970217409251e+000, 3.41040671398805e+000, 3.57262914766893e+000, -4.94794374943502e-001, 7.99956966604889e-001 },
 {-4.11783469175291e-002, 6.86052360711807e-004, 4.23317315570163e-001, 3.98457161622062e-002, -1.31697878080434e+000, 1.30442112214376e+000, 1.82049023984457e-002, -9.41086509736256e-001, -5.04653004932602e-001, -1.98404373799186e-001 },
 {-1.16298280717223e-001, 4.18245542255535e-002, 4.94594214944331e-001, 8.66494960958478e-001, 1.30657406320306e+000, -8.03248290974107e-001, -7.78790359558359e-002, 1.71079152650633e-001, 2.56622492835645e-001, 4.84949311942262e-001 },
 {6.94578671776873e-001, 3.94185563055226e-002, -3.43092483107594e+000, -3.31737480064796e+000, 6.88924507591309e-001, 1.66061930545973e-001, -2.57792502409993e-001, 3.64080055141103e+000, -1.68413859012837e-001, 1.11222334505828e+000 },
 {7.59243169785452e-001, -1.18604407702957e-001, 9.81646935433694e-001, -1.00399980522933e+000, 2.94703736871098e+000, -3.45502348432143e+000, -5.26822478222458e+000, 4.69138512099642e+000, -1.74495828053650e-001, -3.12259258437495e-001 },
 {-2.38134442562587e+000, 4.49903011896738e-002, 8.97147072471015e+000, -2.18098441874548e+000, -1.46340754709472e+000, -6.45702067472851e-001, 2.95126182275563e+000, -1.88858686582149e+000, 1.63737817906539e-002, 7.76265595923431e-002 },
 {3.69925080941643e-001, -1.31713086597100e-002, -1.03043494269634e+000, 4.32945081753686e+000, 7.39226415627013e-001, 4.66708383965236e-001, 3.08323224222994e-001, -1.31721378313200e+000, 2.76848369491166e-001, -3.89833030742939e-001 },
 {-5.31637459241035e-001, 3.87688031483232e-002, -2.31221967486486e+000, -9.47982805842271e-001, -2.25594975991042e+000, 1.01355948538511e+000, 8.98767504983973e-001, -2.45277494356273e-001, -4.08527595411301e-003, -5.39905006727858e-001 },
 {6.01818993776701e-001, -6.44823422606576e-002, -1.94925309790063e+000, 1.62038972237083e-001, -8.71409605671739e-001, 2.20181614999650e+000, -4.76305021386936e-001, -1.90187242346378e+000, 4.36099355236378e-001, -1.17450759764879e+000 },
 {-4.25600124450084e+000, -2.29751798256977e-001, 3.16283336279900e-002, -2.23379030986778e+000, 5.15373053611494e+000, -5.75786222519423e+000, -3.00000870509351e+000, 7.11726795674290e-001, -1.96992814546152e-001, 2.82615984254356e+000 },
 {-5.63080285576410e-001, 1.17317557763753e-001, -1.58488691992341e+000, 3.31650943364181e-001, -2.14882603657669e+000, 2.40907385335398e+000, 3.91239063548515e+000, -3.11742645555346e+000, 1.09085224049125e-001, 4.69656607853057e-001 },
 {-2.42093058319874e+000, -3.84808444601205e-001, -2.29232972831964e+000, 2.47731010514564e+000, -2.31248323613797e+000, 9.83947019872829e-001, 3.43571839622702e+000, -1.99553763009182e+000, 3.34596114085252e+000, -1.10257401472343e+000 },
 {-1.60401470038792e-001, 5.74692671936119e-002, 5.89534182875701e+000, -3.01662946457729e+000, 4.92917622170675e-001, -1.73837852309964e+000, 8.56684598513303e-001, 4.17655380265947e-001, -6.72156500920802e-002, 1.20944591753793e+000 },
 {-2.14657156592552e+000, 2.22415548660126e-002, 3.17846515440095e+000, -1.25962548780351e-001, 1.96899102647692e+000, -4.30297897012859e+000, -1.01868922099624e+000, 4.04306848414737e+000, -3.34743075297859e-001, 4.97734470069123e-001 },
 {6.47400635404989e-001, -4.14657001960437e-002, 5.68033257953563e-001, 3.73414679172545e-001, 1.11605996178741e+000, -4.49924625209108e-001, 2.16137212255460e-001, -6.80004238277679e-001, 2.31617036918415e-002, 3.21037742483605e-001 },
 {-1.12854691672391e-001, -5.34271915646647e-002, 1.20539651172062e+000, -1.42947140379665e-001, 4.44806964587900e-001, -1.11579728773424e+000, -3.18464353415599e-001, 1.03788027157738e+000, 6.76798376902565e+000, 7.40184859429010e-001 },
 {-1.21861173515994e+000, -7.23005554039244e-001, -4.78321370534415e-001, -2.18238668676447e+000, 4.30151948985362e+000, 2.98686376035262e+000, 7.08333906635001e-001, 3.54713861718734e+000, -1.53056701739473e+000, 1.80691658658029e-001 },
 {3.58207593162146e-001, -4.39495969617408e-002, -1.85623872325780e+000, 2.02712756170868e-001, 1.73527638521103e-001, -7.86838490446782e-001, -6.53448675810309e-001, 1.00380543998158e+000, 1.06118538700779e-001, 5.06935051877607e-001 },
 {2.18374433067963e+000, -3.57374446262867e-002, -8.64154612210295e+000, 2.33989159709329e+000, 1.31446797956405e+000, 4.44955556663696e-001, -2.95278480763705e+000, 1.92748309275554e+000, -4.71657317900546e-002, -1.65607035190130e-001 },
 {-1.08599559154829e+000, -3.84758890902931e-002, 1.85025778467033e+000, -6.77901008813802e-001, 2.80441891842083e+000, -2.67372603444626e+000, -1.27473088403234e+000, 3.31943335800441e+000, -8.83374374085222e-002, 1.22123913016156e-001 },
 {1.61226671472074e-001, -6.49077587278493e-003, 3.63167672120117e+000, 8.85946548650908e-001, 2.18904729278706e+000, -1.98521226244600e+000, -7.30941057179523e-001, 6.94215512722292e-001, 3.17769551336933e-002, 4.26362656677052e-001 },
 {2.06305848578423e+000, -3.74278991719381e-004, -2.41784735876439e+000, -4.17598762446387e+000, -2.74710430788662e-001, 2.20436577516156e+000, 2.19077870028583e+000, -7.92160135538898e-001, -6.88294576576716e-002, 6.50240456147280e-001 },
 {8.51911786757941e-001, 6.73804808086724e-003, -5.24476407465321e-001, -2.76567411760518e-001, -1.72638034806809e-001, 1.05401041044569e-001, -5.31143457461511e-002, -4.99043815712755e-002, 1.75045531825809e-001, 1.21094147727397e+000 },
 {1.37223659522238e+000, 7.75410617827024e-002, 4.50705613745458e-001, -1.99523825427945e+000, 4.43732025376434e-001, 1.70979889536164e-001, 6.23338621621727e-001, -1.06943206017438e+000, 5.80038626271468e-005, -8.90206899118089e-001 },
 {-3.93150279904336e-001, -1.12545312361306e+000, -1.66980022519707e+000, 3.47253094627227e+000, 3.06670306068515e-001, -4.31920641352163e+000, -1.38815902615533e-001, 1.76311772281826e+000, -2.19416094978347e+000, 2.42914151693909e+000 },
 {-1.94631922967536e+000, 1.13414178959781e-002, 2.88495017697920e+000, -2.16871543671996e-001, 1.63989391959139e+000, -3.60761657770372e+000, -6.56585616612515e-001, 3.56476825339095e+000, -3.28398992386049e-001, 5.72622480684460e-001 },
 {-5.14579366203751e-001, 5.20904142371099e-003, -2.36286207446763e+000, -1.35521525988762e+000, -1.19629442986172e+000, 3.10246932744786e-002, -1.07192956887062e-001, -5.44698051576949e-001, 2.12208499275242e-001, -1.97572645692814e-001 },
 {2.25731902406648e+000, 2.34932238380052e-001, -1.37411474597978e+000, 6.44591616134331e-001, -2.36541870151530e+000, 2.11165794685722e+000, -9.97659260321543e-002, -1.38175343963050e+000, -5.47126337124072e-001, -1.48171454046368e-001 },
 {1.24978448309212e+000, 1.79562862299507e-002, 4.53023788094035e-001, -1.06810604629517e+000, 1.57637237422720e+000, -7.07075410782659e-001, -2.57163046439290e-001, -1.11730978500555e+000, 1.35452269360571e-002, -1.14548340795103e+000 },
 {1.19047212830266e+000, -7.22575428935109e-002, -2.09150675941113e+000, 2.33383814986028e+000, 1.12286541758437e-001, -2.60430548670559e-001, 1.36577472467438e-001, -5.70714934535463e-001, 1.21042798786027e-001, 4.12933133662385e-002 },
 {9.77691695625487e-001, 2.52197839626338e-001, 4.84597609440956e-001, -8.52280858314320e-001, 2.08050278072903e+000, -1.72066749276522e+000, -2.88254790404927e-001, -2.57911987779394e+000, 1.68494948930213e-001, -1.41864229124162e+000 },
 {3.69150692216674e-001, 4.29454434132082e-002, 5.31883071644695e+000, -3.01634533963211e+000, -1.23997688226518e-002, -1.57244590310855e+000, -2.52794874032973e-001, -3.29677221747475e-001, -2.35384336025413e-002, 7.12572769086578e-001 },
 {1.57363079866028e+000, 3.18852575500319e-001, 6.53347986775073e-001, 6.24544692979853e-001, -2.82430114868391e-001, 9.38707795437088e-002, 2.43704534967807e+000, -1.86829171027936e+000, 1.61644585723365e-001, -5.40660593572981e+000 },
 {-1.28170169335765e+000, -1.01670987537046e-001, -2.14035358480225e+000, -1.37333603147403e+000, 9.95712713180993e-001, -4.79364417863161e+000, -6.97803441228007e-001, -2.40162563977393e+000, 6.91510223753058e-002, -1.31024990759161e+000 } 
};

double global_lw_train_1_MLP_10_40_1_hidden_bias[40]={ -1.51348147044664e+000, 5.21427141875474e-002, 2.54651406271603e+000, 2.31310553321011e+000, 2.47729559510104e+000, 1.20978530964400e+000, 3.59785326473339e+000, 9.70966790842729e-001, -1.90193554205316e+000, 1.65579662701595e+000, -6.61355354737230e-001, -3.21408509510479e+000, -2.18196911018496e+000, 2.86757143439953e+000, 2.02860256286903e+000, 1.32467659692286e+000, 1.04167824351789e+000, -6.61733583066070e-001, -3.49470847741056e+000, -1.41534247933383e+000, -9.32066073917923e-001, -9.80287911749535e+000, 3.99081933082734e+000, 2.10810137103599e+000, 3.30841351107425e+000, -1.10745725994790e-001, -3.17195734972551e+000, 4.18906329573701e+000, -1.99138434738817e+000, 3.52437695351337e+000, -2.90497759510714e+000, -1.50005321379043e+000, 2.02685570589499e+000, -5.21568894881205e-001, 2.27993647619676e+000, 2.40034088124195e+000, 1.29179933769987e+000, -1.61542572751027e+000, 3.17949379740187e+000, 4.92988189578781e+000 };

double global_lw_train_1_MLP_10_40_1_hidden_output_wts[1][40]=
{
 {7.72515138604878e-001, 4.51313344647750e-001, 7.41747243535334e-001, 5.21541891568282e-002, -6.03963447998685e-002, -2.33769189377908e+000, 3.75396346785038e-001, 9.20634759048970e-001, 1.04009051068050e+000, -7.96536118282787e-001, 4.60416796812326e-001, 1.05169637801070e+000, -2.35951718795867e-001, 9.33635002619581e-001, 5.22604032040962e-001, -6.17858429033221e-002, 5.75311001417699e-001, -1.20867238647814e-003, 4.83052697863319e-001, -9.31750028640242e-001, 1.21021417309807e+000, 1.29772418452776e+000, -1.09683305955293e+000, 2.47867400692692e+000, 1.13439775438171e+000, 4.34046838282594e-001, 6.46740794680178e-001, -5.36992402086626e-001, 1.08050701646666e+000, 2.44705314997452e+000, 1.24170321633827e-002, 1.38066682970808e+000, 7.09486529861526e-001, 1.23157316510729e-001, -8.82380504388199e-001, -1.97499993726993e+000, -1.44354246666708e-001, -3.57659431470467e-001, -1.25798696619257e-001, -9.73580852551404e-002 }
};

double global_lw_train_1_MLP_10_40_1_output_bias[1]={ 3.48874805977406e-001 };

double global_lw_train_1_MLP_10_40_1_max_input[10]={ 1.20000000000000e+001, 3.10000000000000e+001, 2.00000000000000e+001, 3.50000000000000e+002, 9.56300000000000e+001, 4.38800000000000e+002, 9.85500000000000e+001, 4.42200000000000e+002, 1.00000000000000e+002, 4.47000000000000e+002 };

double global_lw_train_1_MLP_10_40_1_min_input[10]={ 1.00000000000000e+000, 1.00000000000000e+000, -2.00000000000000e+001, 6.50000000000000e+001, 1.77200000000000e+001, 3.70500000000000e+002, 6.55800000000000e+000, 3.55100000000000e+002, 2.00000000000000e-001, 3.36800000000000e+002 };

double global_lw_train_1_MLP_10_40_1_max_target[1]={ 4.60800000000000e+002 };

double global_lw_train_1_MLP_10_40_1_min_target[1]={ 3.26400000000000e+002 };

double global_lw_train_1_MLP_10_40_1_input[10];
double global_lw_train_1_MLP_10_40_1_hidden[40];
double global_lw_train_1_MLP_10_40_1_output[1];

double global_lw_train_1_MLP_10_40_1_MeanInputs[10]={ 6.57120995211532e+000, 1.57401885767883e+001, 7.79582366589327e-001, 2.36235116256109e+002, 6.14270365799414e+001, 4.06965293478767e+002, 6.10838221355585e+001, 4.07403709828700e+002, 5.59246169225457e+001, 4.06779616922541e+002 };

void global_lw_train_1_MLP_10_40_1_ScaleInputs(double* input, double minimum, double maximum, int size)
{
 double delta;
 long i;
 for(i=0; i<size; i++)
 {
	delta = (maximum-minimum)/(global_lw_train_1_MLP_10_40_1_max_input[i]-global_lw_train_1_MLP_10_40_1_min_input[i]);
	input[i] = minimum - delta*global_lw_train_1_MLP_10_40_1_min_input[i]+ delta*input[i];
 }
}

void global_lw_train_1_MLP_10_40_1_UnscaleTargets(double* output, double minimum, double maximum, int size)
{
  double delta;
  long i;
  for(i=0; i<size; i++)
  {
    delta = (maximum-minimum)/(global_lw_train_1_MLP_10_40_1_max_target[i]-global_lw_train_1_MLP_10_40_1_min_target[i]);
    output[i] = (output[i] - minimum + delta*global_lw_train_1_MLP_10_40_1_min_target[i])/delta;
   }
}

void global_lw_train_1_MLP_10_40_1_ComputeFeedForwardSignals(double* MAT_INOUT,double* V_IN,double* V_OUT, double* V_BIAS,int size1,int size2,int layer)
{
  int row,col;
  for(row=0;row < size2; row++) 
    {
      V_OUT[row]=0.0;
      for(col=0;col<size1;col++)V_OUT[row]+=(*(MAT_INOUT+(row*size1)+col)*V_IN[col]);
      V_OUT[row]+=V_BIAS[row];
      if(layer==0) V_OUT[row] = tanh(V_OUT[row]);
      if(layer==1) V_OUT[row] = tanh(V_OUT[row]);
   }
}

void global_lw_train_1_MLP_10_40_1_RunNeuralNet_Regression () 
{
  global_lw_train_1_MLP_10_40_1_ComputeFeedForwardSignals((double*)global_lw_train_1_MLP_10_40_1_input_hidden_weights,global_lw_train_1_MLP_10_40_1_input,global_lw_train_1_MLP_10_40_1_hidden,global_lw_train_1_MLP_10_40_1_hidden_bias,10, 40,0);
  global_lw_train_1_MLP_10_40_1_ComputeFeedForwardSignals((double*)global_lw_train_1_MLP_10_40_1_hidden_output_wts,global_lw_train_1_MLP_10_40_1_hidden,global_lw_train_1_MLP_10_40_1_output,global_lw_train_1_MLP_10_40_1_output_bias,40, 1,1);
}

int main()
{
 FILE *fp_read,*fp_write;
  int year=0, mon=0, day=0;
  float lat, lon, cafc, cafm, cafd, lwc, lwm, lwd, lwo, lwp;
  char input_file[50],output_file[50];
  printf("%s","Input file: ");
  scanf("%s",input_file);
  printf("%s","Output file: ");
  scanf("%s",output_file);
  fp_read = fopen(input_file, "rt");
  fp_write = fopen(output_file, "wt");
  if(fp_read == NULL)
  printf("\n%s\n","error");
  int   itmp=-1;
  fprintf (fp_write, "mon, day, lat, lon, cafc, lwc, cafm, lwm, cafd, lwd, lwo, lwp \n");
  int count=0;
  int test=1;
  while(1)
  {
	  count++;
	  if (count==1);
	  {
fscanf(fp_read,"%d,%d,%f,%f,%f,%f,%f,%f,%f,%f,%f",&mon,&day,&lat,&lon,&cafc,&lwc,&cafm,&lwm,&cafd,&lwd,&lwo);
	if (feof(fp_read))
	break; 
	
			global_lw_train_1_MLP_10_40_1_input[0]=mon;
			global_lw_train_1_MLP_10_40_1_input[1]=day;
			global_lw_train_1_MLP_10_40_1_input[2]=lat;
			global_lw_train_1_MLP_10_40_1_input[3]=lon;
			global_lw_train_1_MLP_10_40_1_input[4]=cafc;
			global_lw_train_1_MLP_10_40_1_input[5]=lwc;
			global_lw_train_1_MLP_10_40_1_input[6]=cafm;
			global_lw_train_1_MLP_10_40_1_input[7]=lwm;
			global_lw_train_1_MLP_10_40_1_input[8]=cafd;
			global_lw_train_1_MLP_10_40_1_input[9]=lwd;
	
	if (test==1)
	{
	global_lw_train_1_MLP_10_40_1_ScaleInputs(global_lw_train_1_MLP_10_40_1_input,0,1,11);
	global_lw_train_1_MLP_10_40_1_RunNeuralNet_Regression();
	global_lw_train_1_MLP_10_40_1_UnscaleTargets(global_lw_train_1_MLP_10_40_1_output,0,1,1);
	}else{
		global_lw_train_1_MLP_10_40_1_output[0]=-999;
	} 
	fprintf (fp_write, "%2d,%2d,%6.2f,%6.2f,%6.2f,%6.2f,%6.2f,%6.2f,%6.2f,%6.2f,%6.2f,%6.2f \n", mon,day,lat,lon,cafc,lwc,cafm,lwm,cafd,lwd,lwo,global_lw_train_1_MLP_10_40_1_output[0]);
 }
	}
	fclose(fp_read);
	fclose(fp_write);
	return 0;
}
